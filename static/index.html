<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Public Speaking Assessment</title>
<style>
/* Reset & Base */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: #f5f5f7;
  min-height: 100vh;
  padding: 20px;
}

/* Container */
.container {
  max-width: 1200px;
  margin: 0 auto;
  background: white;
  border-radius: 12px;
  padding: 40px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

/* Header */
.header {
  margin-bottom: 30px;
}

.back-btn {
  background: none;
  border: none;
  color: #666;
  font-size: 16px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 15px;
  padding: 8px;
}

.back-btn:hover {
  color: #333;
}

h1 {
  color: #1d1d1f;
  margin-bottom: 5px;
  font-size: 2.2em;
  font-weight: 600;
}

.analyzed-date {
  color: #86868b;
  font-size: 0.95em;
}

/* Upload Section */
.upload-section {
  border: 2px dashed #d2d2d7;
  border-radius: 12px;
  padding: 60px 40px;
  text-align: center;
  margin-bottom: 30px;
  background: #fafafa;
  transition: all 0.3s;
  cursor: pointer;
}

.upload-section:hover {
  border-color: #0071e3;
  background: #f5f8ff;
}

.upload-section.drag-over {
  border-color: #0071e3;
  background: #e6f2ff;
  transform: scale(1.02);
}

input[type="file"] {
  display: none;
}

.upload-btn {
  background: #0071e3;
  color: white;
  padding: 12px 32px;
  border: none;
  border-radius: 8px;
  font-size: 1em;
  cursor: pointer;
  transition: all 0.2s;
  font-weight: 500;
}

.upload-btn:hover {
  background: #0077ed;
}

.filename {
  margin-top: 15px;
  color: #0071e3;
  font-weight: 500;
}

/* Processing */
.processing {
  text-align: center;
  padding: 60px 30px;
  display: none;
}

.spinner {
  border: 3px solid #f3f3f3;
  border-top: 3px solid #0071e3;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  margin: 0 auto 20px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.progress-bar {
  width: 100%;
  max-width: 400px;
  height: 8px;
  background: #f0f0f0;
  border-radius: 4px;
  overflow: hidden;
  margin: 20px auto;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #0071e3, #00a8ff);
  border-radius: 4px;
  transition: width 0.3s ease;
  width: 0%;
}

.progress-text {
  color: #86868b;
  margin-top: 10px;
  font-size: 0.9em;
}

/* Results */
.results {
  display: none;
}

/* Metrics Grid */
.metrics-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 16px;
  margin-bottom: 30px;
}

.metric-card {
  background: white;
  border: 1px solid #e5e5e7;
  border-radius: 12px;
  padding: 20px;
  transition: all 0.2s;
}

.metric-card:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  transform: translateY(-2px);
}

.metric-icon {
  color: #86868b;
  font-size: 0.9em;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.metric-value {
  font-size: 2em;
  font-weight: 700;
  color: #1d1d1f;
}

/* Tabs */
.tabs {
  display: flex;
  gap: 8px;
  margin-bottom: 30px;
  background: #f5f5f7;
  padding: 4px;
  border-radius: 10px;
}

.tab {
  flex: 1;
  padding: 12px 20px;
  border: none;
  background: transparent;
  border-radius: 8px;
  cursor: pointer;
  font-size: 0.95em;
  font-weight: 500;
  color: #1d1d1f;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.tab:hover {
  background: rgba(0, 0, 0, 0.05);
}

.tab.active {
  background: white;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
  animation: fadeIn 0.3s;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Content Card */
.content-card {
  background: white;
  border: 1px solid #e5e5e7;
  border-radius: 12px;
  padding: 24px;
  margin-bottom: 20px;
}

.content-title {
  font-size: 1.4em;
  font-weight: 600;
  color: #1d1d1f;
  margin-bottom: 8px;
}

.content-description {
  color: #86868b;
  margin-bottom: 20px;
  line-height: 1.5;
}

/* Media Player */
.media-player {
  border-radius: 12px;
  overflow: hidden;
  margin: 20px 0;
}

audio {
  width: 100%;
  background: linear-gradient(135deg, #f8f9ff 0%, #e8e9ff 100%);
  border-radius: 12px;
  padding: 10px;
  border: 2px solid #0071e3;
  box-shadow: 0 4px 15px rgba(0, 113, 227, 0.15);
}

video {
  width: 100%;
  max-height: 500px;
  background: #000;
  border-radius: 12px;
}

/* Assessment Badge */
.assessment-badge {
  display: inline-block;
  padding: 8px 16px;
  border-radius: 20px;
  font-size: 0.9em;
  font-weight: 600;
  margin-top: 12px;
}

.badge-excellent {
  background: #d1f4e0;
  color: #0f6938;
}

.badge-good {
  background: #fff3cd;
  color: #856404;
}

/* Checklist */
.checklist {
  margin-top: 20px;
}

.checklist h4 {
  font-size: 1.1em;
  margin-bottom: 12px;
  color: #1d1d1f;
}

.checklist ul {
  list-style: none;
  padding: 0;
}

.checklist li {
  padding: 10px 0;
  color: #1d1d1f;
  border-bottom: 1px solid #e5e5e7;
}

.checklist li:last-child {
  border-bottom: none;
}

.checklist li::before {
  content: "‚Ä¢ ";
  color: #0071e3;
  font-weight: bold;
  margin-right: 8px;
}

/* Word Cloud */
.word-cloud-container {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin: 24px 0;
  padding: 20px;
  background: #fafafa;
  border-radius: 12px;
  min-height: 120px;
  align-items: flex-start;
}

.cloud-word {
  background: white;
  border: 1px solid #e5e5e7;
  border-radius: 8px;
  padding: 10px 16px;
  font-size: 0.95em;
  color: #1d1d1f;
  font-weight: 500;
  transition: all 0.2s ease;
  cursor: default;
  animation: fadeIn 0.4s ease-out backwards;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.cloud-word:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  border-color: #0071e3;
}

.cloud-word-text {
  font-weight: 600;
}

.cloud-word-count {
  color: #86868b;
  font-size: 0.9em;
}

.word-cloud-empty {
  color: #86868b;
  font-size: 1em;
  text-align: center;
  width: 100%;
  padding: 20px;
}

/* Transcript */
.transcript-box {
  background: #fafafa;
  padding: 24px;
  border-radius: 12px;
  line-height: 1.8;
  color: #1d1d1f;
  font-size: 1.05em;
}

.filler-word {
  background: #fff3cd;
  padding: 2px 4px;
  border-radius: 3px;
}

/* Footer Button */
.footer-btn {
  background: #0071e3;
  color: white;
  padding: 14px 40px;
  border: none;
  border-radius: 8px;
  font-size: 1em;
  cursor: pointer;
  display: block;
  margin: 40px auto 0;
  font-weight: 500;
  transition: all 0.2s;
}

.footer-btn:hover {
  background: #0077ed;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0, 113, 227, 0.3);
}

/* Error Message */
.error-message {
  background: #fee;
  color: #c33;
  padding: 16px;
  border-radius: 8px;
  margin: 20px 0;
  border: 1px solid #fcc;
}
</style>
</head>
<body>
<div class="container">
  <!-- Upload Section -->
  <div id="uploadView">
    <div class="header">
      <h1>Master Your Voice üì£</h1>
      <p class="analyzed-date">Upload a video to analyze your speaking skills</p>
    </div>
    
    <div class="upload-section" id="dropZone">
      <div style="font-size:3em; margin-bottom:20px;">üìπ</div>
      <p style="margin-bottom:20px; font-size:1.1em; color:#86868b;">Upload your video (MP4, WebM, MOV)</p>
      <p style="margin-bottom:20px; font-size:0.95em; color:#0071e3; font-weight:600;">
        üìπ Upload videos up to 5 minutes
      </p>
      <input type="file" id="videoInput" accept="video/*">
      <button class="upload-btn" onclick="document.getElementById('videoInput').click()">Choose Video</button>
      <div class="filename" id="filename"></div>
    </div>
  </div>
  
  <!-- Processing -->
  <div class="processing" id="processing">
    <div class="spinner"></div>
    <p style="color:#1d1d1f; font-size:1.1em; margin-bottom:8px;">Processing your video...</p>
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
    <p class="progress-text" id="progressText">Uploading...</p>
  </div>
  
  <!-- Results View -->
  <div class="results" id="results">
    <div class="header">
      <button class="back-btn" onclick="resetApp()">‚Üê Back</button>
      <h1>Your Assessment</h1>
      <p class="analyzed-date" id="analyzedDate">Analyzed today</p>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" onclick="switchTab(event, 'audio')">üîä Tone & Rate of Speech</button>
      <button class="tab" onclick="switchTab(event, 'video')">üé• Body Language Analysis</button>
      <button class="tab" onclick="switchTab(event, 'transcript')">üìÑ Transcript</button>
    </div>

    <!-- Audio Tab -->
    <div class="tab-content active" id="audioTab">
      <div class="content-card">
        <h2 class="content-title">Audio Analysis</h2>
        <p class="content-description">Listen to your speech without visual distractions. Focus on your tone, pace, and vocal delivery.</p>
        <div class="media-player">
          <audio id="audioOnly" controls></audio>
        </div>
        <div class="metrics-grid" style="margin-top:24px;">
          <div class="metric-card">
            <div class="metric-icon">üìä Speech Rate</div>
            <div class="metric-value" id="speechRate">-- wpm</div>
          </div>
        </div>
        <div style="margin-top:24px;">
          <strong style="color:#1d1d1f;">Assessment:</strong>
          <span class="assessment-badge" id="ratebadge"></span>
          <p style="color:#86868b; margin-top:8px;" id="rateAssessment"></p>
        </div>
      </div>
    </div>

    <!-- Video Tab -->
    <div class="tab-content" id="videoTab">
      <div class="content-card">
        <h2 class="content-title">Body Language Review</h2>
        <p class="content-description">Watch your video without sound to focus on your gestures, posture, and non-verbal communication.</p>
        <div class="media-player">
          <video id="videoOnly" controls muted></video>
        </div>
        <div class="checklist">
          <h4>Things to observe:</h4>
          <ul>
            <li>Are you making eye contact with the camera?</li>
            <li>Is your posture confident and open?</li>
            <li>Are your gestures natural and purposeful?</li>
            <li>Do you appear engaged and energetic?</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Transcript Tab -->
    <div class="tab-content" id="transcriptTab">
      <div class="content-card">
        <h2 class="content-title">Transcript & Filler Words</h2>
        <p class="content-description">Review your speech text with filler words highlighted in yellow.</p>
        <div class="metrics-grid" style="margin-bottom:24px;">
          <div class="metric-card">
            <div class="metric-icon">üé§ Total Filler Words</div>
            <div class="metric-value" id="fillerWords">--</div>
          </div>
          <div class="metric-card">
            <div class="metric-icon">‚ö° Filler Rate</div>
            <div class="metric-value" id="fillerRate">-- /min</div>
          </div>
        </div>
        <h3 style="font-size:1.2em; margin-bottom:12px; color:#1d1d1f;">Word Cloud</h3>
        <div class="word-cloud-container" id="wordCloud">
          <div class="word-cloud-empty">No filler words detected! üéâ</div>
        </div>
        <h3 style="font-size:1.2em; margin-top:32px; margin-bottom:12px; color:#1d1d1f;">Full Transcript</h3>
        <div class="transcript-box" id="transcript">Transcription will appear here...</div>
      </div>
    </div>

    <button class="footer-btn" onclick="resetApp()">Analyze Another Video</button>
  </div>
</div>

<script>
// Configuration
const API_URL = window.location.origin;
let videoFile = null;

// DOM Elements
const videoElement = document.getElementById('videoOnly');
const audioElement = document.getElementById('audioOnly');
const videoInput = document.getElementById('videoInput');
const uploadView = document.getElementById('uploadView');
const processing = document.getElementById('processing');
const results = document.getElementById('results');
const progressFill = document.getElementById('progressFill');
const progressText = document.getElementById('progressText');
const filename = document.getElementById('filename');

// Event Listeners
videoInput.addEventListener('change', handleFileSelect);

// Drag and drop
const dropZone = document.getElementById('dropZone');
dropZone.addEventListener('dragover', handleDragOver);
dropZone.addEventListener('dragleave', handleDragLeave);
dropZone.addEventListener('drop', handleDrop);

// Functions
function handleFileSelect(e) {
  if (!e.target.files.length) return;
  loadVideo(e.target.files[0]);
}

function handleDragOver(e) {
  e.preventDefault();
  e.stopPropagation();
  dropZone.classList.add('drag-over');
}

function handleDragLeave(e) {
  e.preventDefault();
  e.stopPropagation();
  dropZone.classList.remove('drag-over');
}

function handleDrop(e) {
  e.preventDefault();
  e.stopPropagation();
  dropZone.classList.remove('drag-over');
  
  const files = e.dataTransfer.files;
  if (files.length) {
    loadVideo(files[0]);
  }
}

function loadVideo(file) {
  videoFile = file;
  filename.textContent = file.name;
  
  // Set up local playback
  const objectURL = URL.createObjectURL(file);
  videoElement.src = objectURL;
  videoElement.muted = true;
  audioElement.src = objectURL;
  
  // Start processing
  processVideo(file);
}

async function processVideo(file) {
  // Show processing view
  uploadView.style.display = 'none';
  processing.style.display = 'block';
  progressFill.style.width = '10%';
  progressText.textContent = 'Uploading video...';

  const formData = new FormData();
  formData.append('video', file);

  try {
    const response = await fetch(`${API_URL}/analyze`, {
      method: 'POST',
      body: formData
    });
    
    const data = await response.json();
    
    if (!response.ok) {
      throw new Error(data.error || 'Server error');
    }
    
    progressFill.style.width = '100%';
    progressText.textContent = 'Complete!';
    
    setTimeout(() => displayResults(data), 500);
  } catch (err) {
    alert(`Error: ${err.message}`);
    resetApp();
  }
}

function displayResults(data) {
  // Hide processing, show results
  processing.style.display = 'none';
  results.style.display = 'block';
  
  // Populate metrics
  document.getElementById('speechRate').textContent = `${data.words_per_min} wpm`;
  document.getElementById('fillerWords').textContent = data.filler_count;
  document.getElementById('fillerRate').textContent = `${data.filler_rate_per_min} /min`;
  
  // Display transcript with highlighted filler words
  document.getElementById('transcript').innerHTML = highlightFillerWords(data.transcript);
  
  // Display word cloud if available
  if (data.filler_words && Object.keys(data.filler_words).length > 0) {
    displayWordCloud(data.filler_words);
  }
  
  // Set assessment badge
  const badgeEl = document.getElementById('ratebadge');
  const assessment = data.assessment?.pace || '';
  
  if (assessment.includes('Excellent')) {
    badgeEl.textContent = 'Excellent';
    badgeEl.className = 'assessment-badge badge-excellent';
  } else if (assessment.includes('Good')) {
    badgeEl.textContent = 'Good';
    badgeEl.className = 'assessment-badge badge-good';
  } else {
    badgeEl.textContent = 'Needs Improvement';
    badgeEl.className = 'assessment-badge';
  }
  
  document.getElementById('rateAssessment').textContent = assessment;
}

function highlightFillerWords(text) {
  const fillerWords = [
    'um', 'uh', 'like', 'you know', 'so', 
    'actually', 'basically', 'literally', 'right', 'okay'
  ];
  
  let highlighted = text;
  
  fillerWords.forEach(word => {
    const regex = new RegExp(`\\b${word}\\b`, 'gi');
    highlighted = highlighted.replace(regex, `<span class="filler-word">${word}</span>`);
  });
  
  return highlighted;
}

function displayWordCloud(fillerWords) {
  const cloudContainer = document.getElementById('wordCloud');
  cloudContainer.innerHTML = '';
  
  const sortedWords = Object.entries(fillerWords)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 15);
  
  sortedWords.forEach(([word, count]) => {
    const wordEl = document.createElement('div');
    wordEl.className = 'cloud-word';
    wordEl.innerHTML = `
      <span class="cloud-word-text">${word}</span>
      <span class="cloud-word-count">${count}</span>
    `;
    cloudContainer.appendChild(wordEl);
  });
}

function switchTab(e, tabName) {
  // Remove active class from all tabs
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  e.target.classList.add('active');
  
  // Hide all tab contents
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  
  // Show selected tab content
  document.getElementById(tabName + 'Tab').classList.add('active');
}

function resetApp() {
  uploadView.style.display = 'block';
  processing.style.display = 'none';
  results.style.display = 'none';
  
  videoInput.value = '';
  filename.textContent = '';
  videoElement.src = '';
  audioElement.src = '';
  videoFile = null;
  
  // Reset to first tab
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelector('.tab').classList.add('active');
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  document.getElementById('audioTab').classList.add('active');
}
</script>
</body>
</html>